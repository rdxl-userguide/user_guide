<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WEHAGO ì „ìê²°ì¬ í¼ ìƒì„±ê¸° (v3.3)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary-color: #5a67d8; --primary-hover: #4c51bf; --border-color: #e2e8f0;
            --background-light: #f7fafc; --background-white: #ffffff; --text-dark: #2d3748;
            --text-light: #718096; --success-color: #38a169;
        }
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

        /* --- ë ˆì´ì•„ì›ƒ êµ¬ì¡° --- */
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Pretendard', sans-serif; background-color: var(--background-light);
            margin: 0; padding: 2rem;
            box-sizing: border-box;
        }
        .main-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            gap: 2rem;
        }
        .fixed-width-container {
            width: 100%;
            max-width: 900px;
        }
        .expandable-width-container {
            width: 100%;
            max-width: 900px; /* JSì— ì˜í•´ ë™ì ìœ¼ë¡œ ë³€ê²½ë¨ */
            transition: max-width 0.4s ease-in-out; /* ë„ˆë¹„ ë³€ê²½ ì• ë‹ˆë©”ì´ì…˜ */
        }

        /* --- ê³µí†µ ìŠ¤íƒ€ì¼ --- */
        h1 { font-size: 2rem; color: var(--text-dark); text-align: center; margin-bottom: 1rem; }
        .section { background: var(--background-white); padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05); }
        h2 { font-size: 1.25rem; color: var(--text-dark); margin-top: 0; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .label-wrapper { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        label { font-weight: 500; font-size: 0.875rem; color: var(--text-light); }
        .label-icons { display: flex; align-items: center; gap: 0.25rem; }
        input, select { width: 100%; padding: 0.75rem; font-size: 1rem; border: 1px solid var(--border-color); border-radius: 0.5rem; box-sizing: border-box; font-family: inherit; transition: all 0.2s; }
        input:focus, select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.15); }
        input::placeholder { color: #cbd5e0; }
        input:read-only, select:disabled { background-color: #f7fafc; color: #718096; cursor: not-allowed; }


        /* --- ì•ˆë‚´ ë¬¸êµ¬ ìŠ¤íƒ€ì¼ --- */
        .app-description {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 2.5rem;
            font-size: 0.9rem;
        }
        .section-description {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: -0.75rem;
            margin-bottom: 1.5rem;
            padding-left: 0.25rem;
        }

        /* --- ë²„íŠ¼ & ì•„ì´ì½˜ --- */
        .button { display: inline-block; padding: 0.75rem 1.5rem; font-size: 1rem; font-weight: 600; color: white; background-color: var(--primary-color); border: none; border-radius: 0.5rem; cursor: pointer; text-align: center; transition: background-color 0.2s; }
        .button:hover { background-color: var(--primary-hover); }
        .button-secondary { background-color: #edf2f7; color: var(--text-dark); }
        .button-secondary:hover { background-color: #e2e8f0; }
        .icon-btn { background: none; border: none; cursor: pointer; font-size: 1rem; padding: 0; line-height: 1; opacity: 0.3; transition: opacity 0.2s; }
        .icon-btn:hover { opacity: 1; }
        .hide-btn { font-size: 1.2rem; font-weight: bold; }
        .lock-icon { cursor: default; opacity: 0.5; }

        /* --- ìˆ¨ê¹€/ë³µì› ê¸°ëŠ¥ --- */
        .restore-section { margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px dashed var(--border-color); }
        .restore-section h4 { margin: 0 0 1rem 0; font-size: 0.9rem; color: var(--text-light); font-weight: 500; }
        .restore-list { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .restore-btn { background-color: #edf2f7; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.25rem 0.75rem; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; }
        .restore-btn:hover { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }

        /* --- í•­ëª©(Item) ì¹´ë“œ --- */
        #items-container-wrapper { width: 100%; overflow-x: auto; margin-top: 1.5rem; }
        #items-container { display: flex; gap: 1.5rem; padding-bottom: 1rem; }
        .item-card { background-color: var(--background-light); border: 1px solid #e2e8f0; padding: 1.5rem; border-radius: 0.5rem; transition: opacity 0.3s, transform 0.3s; flex: 0 0 320px; }
        .item-card.single-item { flex: 1 1 auto; }
        .item-fields-container > div { margin-bottom: 1.25rem; }
        .item-fields-container > div:last-child { margin-bottom: 0; }
        .item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .item-header h3 { margin: 0; font-size: 1.1rem; }
        .remove-item-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light); line-height: 1; }

        /* --- UX ê°œì„  --- */
        #copyFeedback { text-align: center; color: var(--primary-color); font-weight: 600; margin-top: 1rem; opacity: 0; transition: opacity 0.5s; height: 24px;}
        .highlight { transition: box-shadow 0.2s; box-shadow: 0 0 0 3px rgba(56, 161, 105, 0.4); }
        .header-controls { display:flex; justify-content:space-between; align-items:center; }

        /* --- í”¼ë“œë°± ë° ë²„ì „ ì •ë³´ --- */
        .footer-notice {
            text-align: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.7;
        }
        .footer-notice b {
            color: var(--text-dark);
            font-weight: 600;
        }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="fixed-width-container">
        <h1>WEHAGO ì „ìê²°ì¬ í¼ ìƒì„±ê¸° ğŸ’¡</h1>
        <p class="app-description">ëª¨ë“  ì…ë ¥ ë‚´ìš©ê³¼ ì„¤ì •ì€ ìƒˆë¡œê³ ì¹¨í•´ë„ ìë™ìœ¼ë¡œ ë³µì›ë©ë‹ˆë‹¤.</p>

        <div class="section" style="margin-bottom: 2rem;">
            <div class="header-controls">
                <h2>0. ì–‘ì‹ ì¢…ë¥˜ ì„ íƒ</h2>
                <button id="reset-btn" class="button button-secondary" style="padding: 0.5rem 1rem;">[â†»] ìƒˆë¡œ ì‘ì„±</button>
            </div>
            <select id="masterFormType" class="button" style="width:100%; text-align:left; margin-top: 1rem;">
                <option value="general_expense">ì§€ì¶œí’ˆì˜ì„œ - ì¼ë°˜</option>
                <option value="meeting_expense">ì§€ì¶œí’ˆì˜ì„œ - ì‚¬ë‚´ ì‚¬ì™¸ íšŒì˜ë¹„</option>
                <option value="outsourcing_expense">ì§€ì¶œí’ˆì˜ì„œ - ì™¸ì£¼ìš©ì—­</option>
                <option value="education_expense">ì§€ì¶œí’ˆì˜ì„œ - êµìœ¡ë¹„</option>
                <option value="software_expense">ì§€ì¶œí’ˆì˜ì„œ - ì†Œí”„íŠ¸ì›¨ì–´</option>
                <option value="ip_expense">ì§€ì¶œí’ˆì˜ì„œ - ì§€ì‹ì¬ì‚°ê¶Œ</option>
                <option value="travel_expense_claim">ì§€ì¶œìŠ¹ì¸ìš”ì²­ì„œ - êµí†µì—¬ë¹„ ì²­êµ¬</option>
                <option value="business_trip_report">ì¶œì¥í’ˆì˜ì„œ - ì§€ì¶œì •ë³´</option>
            </select>
        </div>
        <div class="section">
            <div class="header-controls">
                <h2>1. ê³µí†µ ì •ë³´ ì…ë ¥</h2>
            </div>
            <p class="section-description">
                ì—¬ê¸°ì— ì…ë ¥í•œ ì •ë³´ëŠ” ëª¨ë“  ì„¸ë¶€ í•­ëª©ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤. ğŸ”“ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ê°œë³„ í•­ëª©ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            <div class="grid" id="common-inputs-container"></div>
            <div id="common-restore-section" class="restore-section" style="display: none;"></div>
            <button id="apply-common-btn" class="button" style="margin-top: 1rem;">[â†“] ì ìš©ëœ ê³µí†µ í•­ëª© í™•ì¸</button>
        </div>
    </div>

    <div class="expandable-width-container">
        <div class="section">
            <div class="header-controls">
                <h2>2. ì„¸ë¶€ í•­ëª© ì…ë ¥</h2>
                <button id="add-item-btn" class="button button-secondary">[+] í•­ëª© ì¶”ê°€</button>
            </div>
             <p class="section-description">
                ê°œë³„ í•­ëª©ì„ ì…ë ¥í•˜ê±°ë‚˜, ğŸ“Œ ì•„ì´ì½˜ìœ¼ë¡œ ê³µí†µ í•­ëª©ìœ¼ë¡œ ê³ ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µí†µ í•­ëª©(ğŸ”’)ì€ ìœ„ì—ì„œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
             </p>
            <div id="items-container-wrapper">
                <div id="items-container"></div>
            </div>
            <div id="item-restore-section" class="restore-section" style="display: none;"></div>
        </div>
    </div>

    <div class="fixed-width-container">
        <button id="copyBtn" class="button" style="width:100%; padding: 1rem; font-size: 1.2rem;">ğŸš€ ìµœì¢… ì–‘ì‹ ìƒì„± ë° ë³µì‚¬</button>
        <div id="copyFeedback">âœ… ë³µì‚¬ ì™„ë£Œ! WEHAGOì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</div>
    </div>
</div>

<div class="footer-notice">
    <p>
        ìœ„í•˜ê³  í¼ ìƒì„±ê¸° ë² íƒ€ í…ŒìŠ¤íŠ¸ (v3.3-ìˆœì„œ ë³€ê²½)<br>
        ê±°ë˜ì²˜ ì¶”ê°€ ìš”ì²­ì´ë‚˜ ê°œì„  ì˜ê²¬ì€ ì–¸ì œë“ ì§€ í™˜ì˜í•©ë‹ˆë‹¤. ê²½ì˜ê¸°íšíŒ€ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.<br>
        <b>FOR RADEXEL INC. USE ONLY</b>
    </p>
</div>

<script>
    // --- (v3.4) ìˆ˜ì •ëœ JavaScript ì½”ë“œ (ì„¸ë¶€ í•­ëª© ê²°ì œìˆ˜ë‹¨ ì§ì ‘ ì…ë ¥) ---
    const vendors = {
        'íŠ¹í—ˆë²•ì¸ ë¹„ì—˜í‹°': { account: 'ìš°ë¦¬ì€í–‰ / 1005303954125 / ì˜ˆê¸ˆì£¼: íŠ¹í—ˆë²•ì¸ ë¹„ì—˜í‹°' },
        '(ì£¼)ê±´ìš°ì‚°ì—…': { account: 'IBKê¸°ì—…ì€í–‰ / 52304175001011 / ì˜ˆê¸ˆì£¼: (ì£¼)ê±´ìš°ì‚°ì—…' },
        '(ì£¼)ëª¨í„°114': { account: 'IBKê¸°ì—…ì€í–‰ / 13703900504018 / ì˜ˆê¸ˆì£¼: (ì£¼)ëª¨í„°114' },
        '(ì£¼)ì»´í“¨ì¡´': { account: 'ìš°ë¦¬ì€í–‰ / 1005101312721 / ì˜ˆê¸ˆì£¼: (ì£¼)ì»´í“¨ì¡´' },
        '(ì£¼)í•˜ë‚˜ê¸°íš': { account: 'í•˜ë‚˜ì€í–‰ / 66791000864104 / ì˜ˆê¸ˆì£¼: (ì£¼)í•˜ë‚˜ê¸°íš' },
        '(ì£¼)í˜„ëŒ€ì‹¤ë¦¬ì½˜': { account: 'êµ­ë¯¼ì€í–‰ / 253250013096 / ì˜ˆê¸ˆì£¼: (ì£¼)í˜„ëŒ€ì‹¤ë¦¬ì½˜' },
        'ë§¤ë‹ˆì•„ì„œí”Œë¼ì´': { account: 'êµ­ë¯¼ì€í–‰ / 92030101750467 / ì˜ˆê¸ˆì£¼: ë§¤ë‹ˆì•„ì„œí”Œë¼ì´' },
        'ë©”íŠ¸ë¡œì‹¤ë¦¬ì½˜': { account: 'êµ­ë¯¼ì€í–‰ / 465701-04-054612 / ì˜ˆê¸ˆì£¼: ë©”íŠ¸ë¡œì‹¤ë¦¬ì½˜' },
        'ë©”íŠ¸ë¡œí…Œí¬': { account: 'IBKê¸°ì—…ì€í–‰ / 41502297701016 / ì˜ˆê¸ˆì£¼: ë©”íŠ¸ë¡œí…Œí¬' },
        'ë°˜ë„NCTë ˆì´ì €': { account: 'IBKê¸°ì—…ì€í–‰ / 20702171901013 / ì˜ˆê¸ˆì£¼: ë°˜ë„NCTë ˆì´ì €' },
        'ë³€í˜¸ì‚¬ ì´ìš°ì§„ ë²•ë¥ ì‚¬ë¬´ì†Œ': { account: 'êµ­ë¯¼ì€í–‰ / 46570104055862 / ì˜ˆê¸ˆì£¼: ë³€í˜¸ì‚¬ ì´ìš°ì§„ ë²•ë¥ ì‚¬ë¬´ì†Œ' },
        'ë¸Œì´ì´ì—”ì§€': { account: 'ì¤‘ì†Œê¸°ì—…ì€í–‰ / 48702598204038 / ì˜ˆê¸ˆì£¼: ë¸Œì´ì´ì—”ì§€' },
        'ì…€íŒŒìŠ¤': { account: 'êµ­ë¯¼ì€í–‰ / 60240104074648 / ì˜ˆê¸ˆì£¼: ì…€íŒŒìŠ¤' },
        'ì•„ì´ì„œë³´': { account: 'IBKê¸°ì—…ì€í–‰ / 18515007601016 / ì˜ˆê¸ˆì£¼: ì•„ì´ì„œë³´' },
        'ìš©ì‚°ì„¼íŠ¸ëŸ´íŒŒí¬ ë‹¨ì§€ ê´€ë¦¬ë‹¨': { account: 'ìš°ë¦¬ì€í–‰ / 1005804073595 / ì˜ˆê¸ˆì£¼: ìš©ì‚°ì„¼íŠ¸ëŸ´íŒŒí¬ ë‹¨ì§€ ê´€ë¦¬ë‹¨' },
        'ì¸ì•„ì˜¤ë¦¬ì—”íƒˆëª¨í„°(ì£¼)': { account: 'ì‹ í•œì€í–‰ / 100030231529 / ì˜ˆê¸ˆì£¼: ì¸ì•„ì˜¤ë¦¬ì—”íƒˆëª¨í„°(ì£¼)' },
        'ì£¼ì‹íšŒì‚¬ ìŠ¤íƒ ë‹¤ë“œë©': { account: 'í•˜ë‚˜ì€í–‰ / 47691002845704 / ì˜ˆê¸ˆì£¼: ì£¼ì‹íšŒì‚¬ ìŠ¤íƒ ë‹¤ë“œë©' },
        'ì£¼ì‹íšŒì‚¬ ì½”ë ˆì´ì¦ˆí™€ë”©ìŠ¤': { account: 'KEBí•˜ë‚˜ì€í–‰ / 37591003038404 / ì˜ˆê¸ˆì£¼: ì£¼ì‹íšŒì‚¬ ì½”ë ˆì´ì¦ˆí™€ë”©ìŠ¤' },
        'ì²­ì†ŒëŒ€ì¥ë¶€': { account: 'ê¸°ì—…ì€í–‰ / 00196758104019 / ì˜ˆê¸ˆì£¼: ì²­ì†ŒëŒ€ì¥ë¶€' },
        'ì¹´ë³¸ë©”ì´í¬': { account: 'ê³„ì¢Œì •ë³´ í™•ì¸ í•„ìš” / ì˜ˆê¸ˆì£¼: ì¹´ë³¸ë©”ì´í¬' },
        'í•œêµ­ë Œíƒˆ': { account: 'ì‚°ì—…ì€í–‰ / 02203006736311 / ì˜ˆê¸ˆì£¼: í•œêµ­ë Œíƒˆ' },
    };

    const paymentMethodOptions = [
        'ìš´ì˜ê³„ì¢Œ ì´ì²´', 'ì—°êµ¬ê³„ì¢Œ ì´ì²´', 'ê°œì¸ë²•ì¸ì¹´ë“œ',
        'SWì¹´ë“œ', 'ë‹¤ê³¼ì¹´ë“œ', 'ì‚¬ë¬´ì¡ë¹„ì¹´ë“œ'
    ];

    const BASE_COMMON_FIELDS = [
        { id: 'vendor', label: 'ê±°ë˜ì²˜/êµ¬ì…ì²˜/ìš©ì—­ì—…ì²´', example: 'ë„¤ì´ë²„í˜ì´, ì§€ì˜¤ë¹„ì „ ë“±' },
        { id: 'paymentMethod', label: 'ê²°ì œìˆ˜ë‹¨', type: 'select', options: paymentMethodOptions },
        { id: 'account', label: 'ì…ê¸ˆê³„ì¢Œ', example: 'êµ­ë¯¼ì€í–‰ / 465701-04-054612 / ì˜ˆê¸ˆì£¼ : OOO' },
        { id: 'purpose', label: 'ì§€ì¶œ/êµ¬ë§¤/ìš©ì—­ ëª©ì  ë° í•„ìš”ì„±', example: 'êµ¬ë§¤ë¥¼ ìš”ì²­í•˜ëŠ” ì´ìœ  Â· í•„ìš”ì„±' },
    ];

    const DEFAULT_PINNED_IDS = BASE_COMMON_FIELDS.map(f => f.id);

    const FIELD = {
        itemName: { id: 'itemName', label: 'í’ˆëª©ëª…/ì§€ì¶œëª…', example: 'ì—…ë¬´ìš© ëª¨ë‹ˆí„°, ì‹œë®¬ë ˆì´ì…˜ìš© ì„œë²„' },
        spec: { id: 'spec', label: 'ê·œê²©/ì„¤ëª…/ìš©ì—­ë‚´ìš©/ì§€ì¶œë‚´ìš©', example: 'ê°„ëµí•œ ì„¸ë¶€ ë‚´ìš©' },
        qty: { id: 'qty', label: 'ìˆ˜ëŸ‰', example: '2, 4' },
        unitPrice: { id: 'unitPrice', label: 'ë‹¨ê°€(ì›)', example: '22,000,000 ì› / 10 USD' },
        amount: { id: 'amount', label: 'ì´ ê¸ˆì•¡(ë¶€ê°€ì„¸ í¬í•¨)', example: '44,000,000 ì› / 40 USD' },
        date: { id: 'date', label: 'êµ¬ë§¤/ì§€ì¶œì¼ì', example: '2024. 6. 18.' },
        note: { id: 'note', label: 'ê¸°íƒ€ì‚¬í•­', example: 'íŠ¹ë³„ ìš”ì²­ì‚¬í•­ ë˜ëŠ” ë¶€ê°€ ì •ë³´' },
        user: { id: 'user', label: 'ì‚¬ìš©ì/ì‹ ì²­ì', example: 'ì‚¬ìš©í•  ì„ì§ì›, ë¶€ì„œ, ê³µìš© ë“±' },
        manufacturer: { id: 'manufacturer', label: 'ì œì¡°ì‚¬', example: 'í•œì„±ì»´í“¨í„°, MS, ì¶œíŒì‚¬ ë“±' },
        isRecurring: { id: 'isRecurring', label: 'ì •ê¸°ê²°ì œ ì—¬ë¶€', example: 'ì¼ì‹œë‚© / ë§¤ë…„ / ë§¤ì›” ë“±' },
        recurringPeriod: { id: 'recurringPeriod', label: 'ìë™ ê²°ì œ ê¸°ê°„', example: 'ë¬´ê¸°í•œ, 2023.3.14 ~ 2024.3.14' },
        recurringDate: { id: 'recurringDate', label: 'ìë™ ê²°ì œì¼', example: 'ë§¤ë‹¬ 10ì¼, ë§¤ë…„ 3ì›” ë‘˜ì§¸ ì£¼ ë“±' },
        paymentTerms: { id: 'paymentTerms', label: 'ì§€ê¸‰ ì¡°ê±´', example: '1) ê³„ì•½ê¸ˆ:ê³„ì•½ í›„ 7ì¼ ì´ë‚´ ì´ ê¸ˆì•¡ì˜ 30 % ì§€ê¸‰ || 2) ì™„ë£Œê¸ˆ:ê²°ê³¼ë¬¼ ìŠ¹ì¸ ì‹œ ì”ì—¬ 70 % ì§€ê¸‰' },
        place: { id: 'place', label: 'ì¥ì†Œ/êµìœ¡ì¥ì†Œ', example: 'ì˜¨ë¼ì¸, ë¼ë±ì…€ íšŒì˜ì‹¤ ë“±' },
        attendees: { id: 'attendees', label: 'ì°¸ì„ì/êµìœ¡ëŒ€ìƒ', example: 'ëŒ€ìƒ ì§ì›, ë¶€ì„œ, ì „ ì„ì§ì› ë“±' },
        service: { id: 'service', label: 'ìš©ì—­ëª…', example: 'ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ì™¸ì£¼ ìš©ì—­' },
        periodFrom: { id: 'periodFrom', label: 'ê¸°ê°„(ì‹œì‘)', example: '2024. 6. 18.' },
        periodTo: { id: 'periodTo', label: 'ê¸°ê°„(ì¢…ë£Œ)', example: '2024. 7. 18.' },
        course: { id: 'course', label: 'êµìœ¡ëª…ì¹­', example: 'ë°ì´í„°ë¶„ì„ ì‹¤ë¬´ ê°•ì˜' },
        provider: { id: 'provider', label: 'ê°•ì‚¬/êµìœ¡ê¸°ê´€', example: 'í™ê¸¸ë™/íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤' },
        relatedTask: { id: 'relatedTask', label: 'ê´€ë ¨ ì—…ë¬´', example: 'OOO í”„ë¡œì íŠ¸' },
        license: { id: 'license', label: 'ì œí’ˆ/ë¼ì´ì„ ìŠ¤ëª…', example: 'ë¯¸ë¡œë³´ë“œ ë¹„ì¦ˆë‹ˆìŠ¤ í”Œëœ' },
        seats: { id: 'seats', label: 'ë¼ì´ì„ ìŠ¤ ìˆ˜', example: '2, 4' },
        origin: { id: 'origin', label: 'ì¶œë°œì§€', example: 'íšŒì‚¬' },
        destination:{ id: 'destination',label: 'ë„ì°©ì§€', example: 'ê°•ì›ëŒ€ë³‘ì›' },
        tripObjective:{id: 'tripObjective',label:'ì¶œì¥ ëª©ì ', example: 'ì˜ë£Œê¸°ê¸° ì„¤ì¹˜' },
        proof: { id: 'proof', label: 'ì¦ë¹™ìë£Œ', example: 'ë„¤ì´ë²„ ê¸¸ì°¾ê¸° ìº¡ì²˜ ì²¨ë¶€' },
        expenseTransit:{ id:'expenseTransit',label:'êµí†µë¹„', example: 'í•­ê³µë£Œ, ê¸°ì°¨ë£Œ ë“± ì´ ê¸ˆì•¡' },
        expenseLodging:{id:'expenseLodging',label:'ìˆ™ë°•ë¹„', example: 'ìˆ™ë°•ë¹„ ì´ ê¸ˆì•¡' },
        expenseMeal:{id:'expenseMeal',label:'ì‹ë¹„', example: 'ì—…ë¬´ ê´€ë ¨ ì‹ì‚¬ ë¹„ìš©' },
        expenseOther:{id:'expenseOther',label:'ê¸°íƒ€ë¹„ìš©', example: 'ê¸°íƒ€ ë¹„ìš© ì´ ê¸ˆì•¡' },
        ipMgmtNo: { id: 'ipMgmtNo', label: 'íŠ¹í—ˆ ê´€ë¦¬ë²ˆí˜¸', example: 'BPP2021-0030US' },
        invoiceNo: { id: 'invoiceNo', label: 'ì²­êµ¬ì„œ ë²ˆí˜¸', example: 'SPS24-2336' },
    };

    const T = (title, ...fields) => ({ title, fields: [...BASE_COMMON_FIELDS, ...Object.values(FIELD).filter(f => fields.includes(f))] });

    const formTemplates = {
        'general_expense': T('ì§€ì¶œí’ˆì˜ì„œ - ì¼ë°˜', FIELD.itemName, FIELD.unitPrice, FIELD.qty, FIELD.manufacturer, FIELD.amount, FIELD.isRecurring, FIELD.recurringPeriod, FIELD.recurringDate, FIELD.date, FIELD.paymentTerms, FIELD.user, FIELD.note),
        'meeting_expense': T('ì§€ì¶œí’ˆì˜ì„œ - ì‚¬ë‚´ ì‚¬ì™¸ íšŒì˜ë¹„', FIELD.itemName, FIELD.amount, FIELD.user, FIELD.note),
        'outsourcing_expense': T('ì§€ì¶œí’ˆì˜ì„œ - ì™¸ì£¼ìš©ì—­', FIELD.service, FIELD.periodFrom, FIELD.periodTo, FIELD.spec, FIELD.user, FIELD.amount, FIELD.isRecurring, FIELD.recurringPeriod, FIELD.recurringDate, FIELD.paymentTerms, FIELD.note),
        'education_expense': T('ì§€ì¶œí’ˆì˜ì„œ - êµìœ¡ë¹„', FIELD.course, FIELD.provider, FIELD.periodFrom, FIELD.periodTo, FIELD.place, FIELD.attendees, FIELD.amount, FIELD.relatedTask, FIELD.note),
        'software_expense': T('ì§€ì¶œí’ˆì˜ì„œ - ì†Œí”„íŠ¸ì›¨ì–´', FIELD.license, FIELD.unitPrice, FIELD.seats, FIELD.manufacturer, FIELD.amount, FIELD.isRecurring, FIELD.recurringPeriod, FIELD.recurringDate, FIELD.date, FIELD.paymentTerms, FIELD.user, FIELD.note),
        'ip_expense': T('ì§€ì¶œí’ˆì˜ì„œ - ì§€ì‹ì¬ì‚°ê¶Œ', FIELD.spec, FIELD.ipMgmtNo, FIELD.invoiceNo, FIELD.amount, FIELD.paymentTerms, FIELD.note),
        'travel_expense_claim': T('ì§€ì¶œìŠ¹ì¸ìš”ì²­ì„œ - êµí†µì—¬ë¹„ ì²­êµ¬', FIELD.date, FIELD.origin, FIELD.destination, FIELD.tripObjective, FIELD.amount, FIELD.proof),
        'business_trip_report': T('ì¶œì¥í’ˆì˜ì„œ - ì§€ì¶œì •ë³´', FIELD.tripObjective, FIELD.place, FIELD.expenseTransit, FIELD.expenseLodging, FIELD.expenseMeal, FIELD.expenseOther, FIELD.amount, FIELD.note),
    };

    let items = [{}];
    let currentFormType = 'general_expense';
    let hiddenFields = [];
    let pinnedFields = [...DEFAULT_PINNED_IDS];
    let commonData = {};

    const expandableContainer = document.querySelector('.expandable-width-container');
    const commonInputsContainer = document.getElementById('common-inputs-container');
    const itemsContainer = document.getElementById('items-container');
    const addItemBtn = document.getElementById('add-item-btn');
    const applyCommonBtn = document.getElementById('apply-common-btn');
    const copyBtn = document.getElementById('copyBtn');
    const formTypeSelector = document.getElementById('masterFormType');
    const resetBtn = document.getElementById('reset-btn');

    applyCommonBtn.textContent = '[â†“] ê³µí†µ ì •ë³´ ì¼ê´„ ì ìš©';

    const saveState = () => {
        localStorage.setItem('wehagoFormData', JSON.stringify({ items, currentFormType, hiddenFields, pinnedFields, commonData }));
    };

    const loadState = () => {
        try {
            const savedState = localStorage.getItem('wehagoFormData');
            if (savedState) {
                const data = JSON.parse(savedState);
                items = data.items && data.items.length > 0 ? data.items : [{}];
                currentFormType = data.currentFormType || 'general_expense';
                hiddenFields = data.hiddenFields || [];
                pinnedFields = data.pinnedFields || [...DEFAULT_PINNED_IDS];
                commonData = data.commonData || {};
                formTypeSelector.value = currentFormType;
            }
        } catch (e) { console.error("Could not load state", e); }
    };

    const adjustContainerWidth = () => {
        const section = expandableContainer.querySelector('.section');
        const bodyPadding = parseFloat(getComputedStyle(document.body).paddingLeft) * 2;
        const sectionPadding = parseFloat(getComputedStyle(section).paddingLeft) * 2;
        const maxAllowedWidth = window.innerWidth - bodyPadding;
        const cardWidth = 320;
        const cardGap = 1.5 * 16;
        const defaultWidth = 900;
        let requiredContainerWidth = (items.length <= 1) ? defaultWidth : ((items.length * (cardWidth + cardGap)) - cardGap) + sectionPadding;
        const finalContainerWidth = Math.min(requiredContainerWidth, maxAllowedWidth);
        expandableContainer.style.maxWidth = `${Math.max(finalContainerWidth, defaultWidth)}px`;
        const actualContentWidth = (items.length * cardWidth) + (Math.max(0, items.length - 1) * cardGap);
        itemsContainer.style.width = items.length > 1 ? `${actualContentWidth}px` : '100%';
    };

    function render() {
        const template = formTemplates[currentFormType];
        const allFields = template.fields;

        // í‘œì‹œ ìš°ì„ ìˆœìœ„(ì•ì— ìˆì„ìˆ˜ë¡ ìœ„ìª½). ëª©ë¡ì— ì—†ëŠ” í•„ë“œëŠ” ê¸°ì¡´ í…œí”Œë¦¿ ë‚´ ìƒëŒ€ìˆœì„œ ìœ ì§€
        const FIELD_ORDER = [
            'itemName','service','course','license','tripObjective',
            'purpose','spec','relatedTask',
            'vendor',
            'qty','seats','unitPrice','amount',
            'date','periodFrom','periodTo',
            'isRecurring','recurringPeriod','recurringDate',
            'paymentMethod','account',
            'origin','destination','place','attendees','provider','manufacturer',
            'ipMgmtNo','invoiceNo','proof',
            'user','paymentTerms','note'
        ];
        const orderIndex = (id) => {
            const i = FIELD_ORDER.indexOf(id);
            return i === -1 ? 1000 + allFields.findIndex(f => f.id === id) : i;
        };
        const sortFields = (arr) => arr.slice().sort((a, b) => orderIndex(a.id) - orderIndex(b.id));

        const visiblePinnedFields = sortFields(allFields.filter(f => pinnedFields.includes(f.id) && !hiddenFields.includes(f.id)));
        commonInputsContainer.innerHTML = visiblePinnedFields.map(field => {
            const value = commonData[field.id] || '';
            let inputHtml = `<div>
                <div class="label-wrapper">
                    <label for="common_${field.id}">${field.label}</label>
                    <div class="label-icons">
                        <button class="icon-btn pin-btn" data-pin-action="unpin" data-field-id="${field.id}" title="ê°œë³„ í•­ëª©ìœ¼ë¡œ ë³€ê²½">ğŸ”“</button>
                        <button class="icon-btn hide-btn" tabindex="-1" data-field-id="${field.id}" title="í•­ëª© ìˆ¨ê¸°ê¸°">Ã—</button>
                    </div>
                </div>`;

            if (field.id === 'vendor') {
                const optionsHtml = Object.keys(vendors).map(k => `<option value="${k}" ${value === k ? 'selected' : ''}>${k}</option>`).join('');
                inputHtml += `<select id="common_${field.id}"><option value="">-- ì§ì ‘ ì…ë ¥ --</option>${optionsHtml}</select>`;
            } else if (field.type === 'select') {
                const optionsHtml = field.options.map(opt => `<option value="${opt}" ${value === opt ? 'selected' : ''}>${opt}</option>`).join('');
                inputHtml += `<select id="common_${field.id}"><option value="">-- ì„ íƒ --</option>${optionsHtml}</select>`;
            } else {
                inputHtml += `<input type="text" id="common_${field.id}" value="${value}" placeholder="${field.example || ''}">`;
            }
            return inputHtml + `</div>`;
        }).join('');

        const allVisibleFields = sortFields(allFields.filter(f => !hiddenFields.includes(f.id)));
        itemsContainer.innerHTML = items.map((itemData, index) => {
            const itemFieldsHtml = allVisibleFields.map(field => {
                const isPinned = pinnedFields.includes(field.id);
                const value = itemData[field.id] || '';
                const uniqueId = `${field.id}_${index}`;

                let iconsHtml = isPinned
                    ? `<button class="icon-btn lock-icon" title="ê³µí†µ í•­ëª©ì…ë‹ˆë‹¤. ìœ„ì—ì„œ ì¼ê´„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.">ğŸ”’</button>`
                    : `<button class="icon-btn pin-btn" data-pin-action="pin" data-field-id="${field.id}" title="ê³µí†µ í•­ëª©ìœ¼ë¡œ ê³ ì •">ğŸ“Œ</button>
                       <button class="icon-btn hide-btn" tabindex="-1" data-field-id="${field.id}" title="í•­ëª© ìˆ¨ê¸°ê¸°">Ã—</button>`;

                let fieldHtml = `<div>
                    <div class="label-wrapper">
                        <label for="${uniqueId}">${field.label}</label>
                        <div class="label-icons">${iconsHtml}</div>
                    </div>`;

                // --- â–¼â–¼â–¼ ì—¬ê¸°ê°€ ìœ ì¼í•˜ê²Œ ìˆ˜ì •ëœ ë¶€ë¶„ì…ë‹ˆë‹¤ â–¼â–¼â–¼ ---
                if (field.type === 'select') {
                    // ì„¸ë¶€ í•­ëª©ì˜ 'ê²°ì œìˆ˜ë‹¨'ë§Œ input[type=text]ìœ¼ë¡œ ë Œë”ë§
                    if (field.id === 'paymentMethod') {
                         fieldHtml += `<input type="text" id="${uniqueId}" value="${value}" placeholder="ì§ì ‘ ì…ë ¥...">`;
                    } else {
                        // ë‹¤ë¥¸ select í•„ë“œëŠ” ê¸°ì¡´ëŒ€ë¡œ ë Œë”ë§
                        const optionsHtml = field.options.map(opt => `<option value="${opt}" ${value === opt ? 'selected' : ''}>${opt}</option>`).join('');
                        fieldHtml += `<select id="${uniqueId}"><option value="">-- ì„ íƒ --</option>${optionsHtml}</select>`;
                    }
                } else {
                     fieldHtml += `<input type="text" id="${uniqueId}" value="${value}" placeholder="${field.example || ''}">`;
                }
                // --- â–²â–²â–² ì—¬ê¸°ê°€ ìœ ì¼í•˜ê²Œ ìˆ˜ì •ëœ ë¶€ë¶„ì…ë‹ˆë‹¤ â–²â–²â–² ---

                return fieldHtml + `</div>`;
            }).join('');

            return `
                <div class="item-card" data-index="${index}">
                    <div class="item-header"><h3>í•­ëª© ${index + 1}</h3>${items.length > 1 ? '<button class="remove-item-btn" tabindex="-1" title="í•­ëª© ì‚­ì œ">Ã—</button>' : ''}</div>
                    <div class="item-fields-container">${itemFieldsHtml}</div>
                </div>`;
        }).join('');

        const hiddenCommonFields = allFields.filter(f => hiddenFields.includes(f.id) && pinnedFields.includes(f.id));
        const hiddenItemOnlyFields = allFields.filter(f => hiddenFields.includes(f.id) && !pinnedFields.includes(f.id));
        renderRestoreSection('common-restore-section', hiddenCommonFields);
        renderRestoreSection('item-restore-section', hiddenItemOnlyFields);

        if (items.length === 1) itemsContainer.querySelector('.item-card')?.classList.add('single-item');
        adjustContainerWidth();
        saveState();
    }

    function renderRestoreSection(sectionId, hiddenFields) {
        const sectionEl = document.getElementById(sectionId);
        if (hiddenFields.length > 0) {
            sectionEl.style.display = 'block';
            sectionEl.innerHTML = `
                <h4>[+] ë³µì›í•  í•­ëª©ì„ í´ë¦­í•˜ì„¸ìš”</h4>
                <div class="restore-list">${hiddenFields.map(f => `<button class="restore-btn" data-field-id="${f.id}">${f.label}</button>`).join('')}</div>`;
        } else {
            sectionEl.style.display = 'none';
        }
    }

    function handlePinClick(e) {
        const btn = e.target.closest('.pin-btn');
        if (!btn) return;

        const fieldId = btn.dataset.fieldId;
        const action = btn.dataset.pinAction;

        if (action === 'pin') {
            if (!pinnedFields.includes(fieldId)) pinnedFields.push(fieldId);
            const valueFromFirstItem = items.length > 0 ? (items[0][fieldId] || '') : '';
            commonData[fieldId] = valueFromFirstItem;
            items.forEach(item => item[fieldId] = valueFromFirstItem);
        } else if (action === 'unpin') {
            const index = pinnedFields.indexOf(fieldId);
            if (index > -1) pinnedFields.splice(index, 1);
        }
        render();
    }

    function handleIconClick(e) {
        const btn = e.target.closest('.hide-btn');
        if (!btn) return;
        const fieldId = btn.dataset.fieldId;
        if (!hiddenFields.includes(fieldId)) hiddenFields.push(fieldId);
        render();
    }

    function handleRestoreClick(e) {
        const restoreBtn = e.target.closest('.restore-btn');
        if (restoreBtn) {
            const fieldId = restoreBtn.dataset.fieldId;
            const index = hiddenFields.indexOf(fieldId);
            if(index > -1) {
                hiddenFields.splice(index, 1);
                render();
            }
        }
    }

    document.getElementById('common-restore-section').addEventListener('click', handleRestoreClick);
    document.getElementById('item-restore-section').addEventListener('click', handleRestoreClick);

    commonInputsContainer.addEventListener('click', (e) => {
        handleIconClick(e);
        handlePinClick(e);
    });
    itemsContainer.addEventListener('click', (e) => {
        handleIconClick(e);
        handlePinClick(e);
        if (e.target.classList.contains('remove-item-btn')) {
            items.splice(e.target.closest('.item-card').dataset.index, 1);
            if (items.length === 0) items.push({});
            render();
        }
    });

    commonInputsContainer.addEventListener('input', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
            const fieldId = e.target.id.replace('common_', '');
            commonData[fieldId] = e.target.value;
            if (fieldId === 'vendor' && vendors[e.target.value]) {
                commonData['account'] = vendors[e.target.value].account || '';
                const accountInput = document.getElementById('common_account');
                if(accountInput) accountInput.value = commonData['account'];
            }
            saveState();
        }
    });

    applyCommonBtn.addEventListener('click', () => {
        items.forEach(item => {
            pinnedFields.forEach(fieldId => {
                item[fieldId] = commonData[fieldId] || '';
            });
        });
        render();
        items.forEach((_, index) => {
            pinnedFields.forEach(fieldId => {
                const element = document.getElementById(`${fieldId}_${index}`);
                if (element) {
                    element.classList.add('highlight');
                    setTimeout(() => element.classList.remove('highlight'), 1200);
                }
            });
        });
    });

    addItemBtn.addEventListener('click', () => {
        const lastItem = items[items.length - 1] || {};
        const newItem = {};
        const templateFields = formTemplates[currentFormType].fields;

        templateFields.forEach(field => {
            if (pinnedFields.includes(field.id)) {
                newItem[field.id] = commonData[field.id] || '';
            } else if (lastItem[field.id] !== undefined) {
                 newItem[field.id] = lastItem[field.id];
            }
        });
        items.push(newItem);

        render();
        const newCard = itemsContainer.lastElementChild;
        if (newCard) {
            newCard.querySelector('input, select')?.focus();
            newCard.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }
    });

    itemsContainer.addEventListener('input', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
            const index = e.target.closest('.item-card').dataset.index;
            const fieldId = e.target.id.split('_')[0];
            items[index][fieldId] = e.target.value;
            saveState();
        }
    });

    formTypeSelector.addEventListener('change', (e) => {
        if (confirm('ì–‘ì‹ì„ ë³€ê²½í•˜ë©´ í˜„ì¬ ì‘ì„±ëœ í•­ëª©ê³¼ ëª¨ë“  ì„¤ì •ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            currentFormType = e.target.value;
            items = [{}];
            hiddenFields = [];
            pinnedFields = [...DEFAULT_PINNED_IDS];
            commonData = {};
            pinnedFields.forEach(fieldId => {
                items[0][fieldId] = commonData[fieldId] || '';
            });
            localStorage.removeItem('wehagoFormData');
            render();
        } else {
            e.target.value = currentFormType;
        }
    });

    resetBtn.addEventListener('click', () => {
        if (confirm('ì •ë§ë¡œ ëª¨ë“  í•­ëª©ê³¼ ì„¤ì •ì„ ì§€ìš°ê³  ìƒˆë¡œ ì‘ì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            items = [{}];
            hiddenFields = [];
            pinnedFields = [...DEFAULT_PINNED_IDS];
            commonData = {};
            pinnedFields.forEach(fieldId => {
                items[0][fieldId] = commonData[fieldId] || '';
            });
            localStorage.removeItem('wehagoFormData');
            render();
        }
    });

    copyBtn.addEventListener('click', () => {
        const template = formTemplates[currentFormType];
        const FONT = "font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif; font-size: 10pt;";
        const TD_L = `padding: 8px; font-weight: bold; text-align: center; background-color: #f2f2f2; ${FONT}`;
        const TD_V = `padding: 8px; vertical-align: top; ${FONT}`;
        const header = `<tr><td style="${TD_L}">${template.title}</td>${items.map((_, i) => `<td style="text-align:center; font-weight:bold; background-color:#deebee; padding:8px; ${FONT}">í•­ëª© ${i+1}</td>`).join('')}</tr>`;

        const allVisibleFields = template.fields.filter(field => !hiddenFields.includes(field.id));
        // í‘œì‹œ ìˆœì„œ ì •ë ¬(ê³µí†µ/ê°œë³„ êµ¬ë¶„ ì—†ì´)
        const FIELD_ORDER = [
            'itemName','service','course','license','tripObjective',
            'purpose','spec','relatedTask',
            'vendor',
            'qty','seats','unitPrice','amount',
            'date','periodFrom','periodTo',
            'isRecurring','recurringPeriod','recurringDate',
            'paymentMethod','account',
            'origin','destination','place','attendees','provider','manufacturer',
            'ipMgmtNo','invoiceNo','proof',
            'user','paymentTerms','note'
        ];
        const orderIndex = (id) => {
            const i = FIELD_ORDER.indexOf(id);
            return i === -1 ? 1000 + template.fields.findIndex(f => f.id === id) : i;
        };
        const sortFields = (arr) => arr.slice().sort((a, b) => orderIndex(a.id) - orderIndex(b.id));
        const fieldsToCopy = sortFields(allVisibleFields);

        const bodyRows = fieldsToCopy.map(field => {
            return `<tr><td style="${TD_L}">${field.label}</td>${items.map(item => {
                const value = item[field.id] || '';
                return `<td style="${TD_V}">${(value || '').replace(/\n/g, '<br>')}</td>`;
            }).join('')}</tr>`;
        }).join('');

        const finalHtml = `<table border="1" style="border-collapse: collapse; width: 100%; ${FONT}"><thead>${header}</thead><tbody>${bodyRows}</tbody></table>`;
        try {
            navigator.clipboard.write([new ClipboardItem({ 'text/html': new Blob([finalHtml], { type: 'text/html' }) })]);
            const fb = document.getElementById('copyFeedback');
            fb.style.opacity = '1';
            setTimeout(() => { fb.style.opacity = '0'; }, 2000);
        } catch(e) {
            console.error(e);
            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
    });

    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => { adjustContainerWidth(); }, 150);
    });

    loadState();
    render();
</script>
</body>
</html>
